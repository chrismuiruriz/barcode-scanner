var $$=Dom7;$mainUrl="http://dev.bean.co.ke/smollan-api/api/";var theme="auto";if(document.location.search.indexOf("theme=")>=0){theme=document.location.search.split("theme=")[1].split("&")[0]}var app=new Framework7({theme:"md",init:false,cache:false,view:{pushState:true},root:"#app",name:"SMOLLAN",id:"co.ke.smollan",panel:{swipe:"right"},routes:routes});var $$=app.$;if(app.device.desktop){app.dialog.alert("We've detected you are using a desktop device to view this app, for the best user experience, kindly view it on your smartphone., ",null)}var mainView=app.view.create(".view-main");app.on("pageInit",function(b){var a=b.name;if(a!=="login"){if(!localStorage.login){mainView.router.load({url:"./pages/login-page.html",ignoreCache:true,reload:true})}}else{if(a==="login"){if(localStorage.login){mainView.router.load({url:"./index.html",ignoreCache:true,reload:true})}}}});app.on("pageBeforeIn",function(b){$(".panel-right").removeClass("opacity-none");$(".panel-backdrop").removeClass("opacity-none");var a=b.name;if(a==="login"){if(localStorage.login){mainView.router.load({url:"index.html",ignoreCache:true,reload:true})}}else{if(a==="cooler-details"){coolerDetailsFunctions(b)}else{if(a==="records"){recordsFunctions(b)}}}});var recordsFunctions=function(a){app.preloader.show("Loading...");var b=$mainUrl+"get_records.php";app.request.post(b,{user:localStorage.id,appid:"123"},function(f,d,h){app.preloader.hide();console.log("data",f.data);if(f.status==="SUCCESS"){var c=JSON.parse(f.data);$$("#table-data").empty();for(var g=0;g<c.length;g++){var e="<tr><td>"+c[g]["date_time"]+"</td><td>"+c[g]["cooler"]+"</td><td>"+c[g]["location"]+"</td><td>"+c[g]["user_name"]+"</td><td>"+c[g]["feedback"]+"</td></tr>";$("#table-data").append(e)}}else{app.dialog.alert(f.message,null)}},function(d,c){app.preloader.hide();console.log("Error",d);app.dialog.alert("Connection Error! Check your internet connection and try again!",null)},"json")};var coolerDetailsFunctions=function(b){if($.isEmptyObject(b.route.params)){var c=b.route.query}else{var c=b.route.params}var d=c.code;$("#serial_no").val(d);var a=$mainUrl+"get_cooler.php";app.dialog.preloader("...");app.request.post(a,{code:d},function(f,e,h){app.dialog.close();if(f.status==="SUCCESS"){var g=JSON.parse(f.data);console.log(f.data);$("[data-cooler='serial']").html(g.serial);$("[data-cooler='name']").html(g.name);$("[data-cooler='location']").html(g.location);$("[data-cooler='img']").attr("src",g.image);console.log("Image",g.image)}else{app.dialog.alert(f.message,null)}},function(f,e){app.dialog.close();app.dialog.alert("Connection Error! Check your internet connection and try again.!",null)},"json")};$$("#main-panel").on("panel:open",function(){if(localStorage.userFirstName){$("[data-modal='panelUserFullName']").html(localStorage.name)}});$("body").on("submit","#login-form",function(d){d.preventDefault();var a=$("#login-email-input").val();var b=$("#login-password-input").val();if(a===""||b===""){app.toast.create({text:"Email or Password is missing!",position:"center",closeTimeout:2000}).open();return}else{var c=$mainUrl+"login.php";app.request.post(c,{email:a,password:b},function(f,e,h){app.dialog.close();if(f.status==="SUCCESS"){var g=JSON.parse(f.data);localStorage.login="true";localStorage.id=g.ID;localStorage.name=g.name;localStorage.email=g.email;console.log(f.data);app.dialog.alert(f.message,null,function(){mainView.router.load({url:"./index.html",ignoreCache:true,reload:true})})}else{app.dialog.alert(f.message,null)}},function(f,e){app.dialog.close();app.dialog.alert("Connection Error! Check your internet connection and try again.!",null)},"json")}});$("body").on("submit","#scan-qr-form",function(b){b.preventDefault();if(typeof cordova=="undefined"){var a="353982886721734";var c="QR CODE "+a;app.dialog.alert(c,null,function(){var d="./pages/cooler-details.html?code="+a+"&serial=1";mainView.router.load({url:d,ignoreCache:true,reload:true})});return}cordova.plugins.barcodeScanner.scan(function(d){var e="QR CODE "+d.text;app.dialog.alert(e,null,function(){var f="./pages/cooler-details.html?code="+d.text+"&serial=1";mainView.router.load({url:f,ignoreCache:true,reload:true})})},function(d){alert("Scanning failed: "+d)},{preferFrontCamera:false,showFlipCameraButton:true,showTorchButton:true,torchOn:false,prompt:"Place a the QR Code inside the scan area",resultDisplayDuration:500,orientation:"portrait",disableAnimations:true})});var questionPopup=app.popup.create({content:'<div class="popup"><form class="list" id="quiz-form"><h4 class="quiz-title">Fill in the form below and submit</h4><ul><li><div class="item-content"><div class="item-inner"><div class="item-title">Sheaves Properly Aligned?</div><div class="item-after"><label class="toggle toggle-init"><input type="checkbox" name="sheaves-aligned" value="yes"><i class="toggle-icon"></i></label></div></div></div></li><li><div class="item-content"><div class="item-inner"><div class="item-title">Is this cooler odor-less?</div><div class="item-after"><label class="toggle toggle-init"><input type="checkbox" name="cooler-odorless" value="yes"><i class="toggle-icon"></i></label></div></div></div></li><li><div class="item-content"><div class="item-inner"><div class="item-title">Is temp below 4.4 &#8451;</div><div class="item-after"><label class="toggle toggle-init"><input type="checkbox" name="temp-below-10" value="yes"><i class="toggle-icon"></i></label></div></div></div></li><li><div class="item-content item-input"> <div class="item-inner"><div class="item-title item-label">Comment</div> <div class="item-input-wrap"> <textarea name="comment" id="comment" placeholder="Your comment" rows="4"></textarea> </div> </div> </div> </li></ul><div class="quix-btn-container"><button class="col button button-fill" id="quiz-btn">SUBMIT</button></div></form><div class="block block-strong row"><div class="col"><a class="button fill-form-from-data" href="#" id="close-quiz-popup">Close</a></div></div></div>'});$("body").on("click","#close-quiz-popup",function(a){a.preventDefault();questionPopup.close()});$("body").on("click","#get-quiz-details",function(){questionPopup.open()});$("body").on("submit","#quiz-form",function(f){f.preventDefault();var d=new Object();var j=$("[name='sheaves-aligned']");var i=$("[name='cooler-odorless']");var h=$("[name='stemp-below-10']");if(!j.is(":checked")){d.quiz1="YES"}else{d.quiz1="NO"}if(!i.is(":checked")){d.quiz2="YES"}else{d.quiz2="NO"}if(!h.is(":checked")){d.quiz3="YES"}else{d.quiz3="NO"}d.comment=$("[name='comment']").val();var b=JSON.stringify(d);var a=$("#serial_no").val();var g=$("[data-cooler='location']").html();var c=$mainUrl+"save_records.php";app.dialog.preloader("...");app.request.post(c,{quizData:b,cooler:a,loc:g,userId:localStorage.id,userName:localStorage.name},function(k,e,l){app.dialog.close();if(k.status==="SUCCESS"){app.dialog.alert(k.message,null,function(){questionPopup.close();mainView.router.load({url:"./index.html",ignoreCache:true,reload:true})})}else{app.dialog.alert(k.message,null)}},function(k,e){app.dialog.close();app.dialog.alert("Connection Error! Check your internet connection and try again.!",null)},"json")});app.init();